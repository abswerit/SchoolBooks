<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NCTB স্মার্ট লাইব্রেরি | ডিজিটাল শিক্ষা</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#10B981',
                        secondary: '#3B82F6',
                        dark: '#1F2937',
                    },
                    fontFamily: {
                        sans: ['Hind Siliguri', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Hind Siliguri', sans-serif;
            background-color: #F3F4F6;
            -webkit-font-smoothing: antialiased;
        }
        .hide-scroll::-webkit-scrollbar {
            display: none;
        }
        .hide-scroll {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }
        .glass-dark {
            background: rgba(17, 24, 39, 0.8);
            backdrop-filter: blur(12px);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- ICONS (SVG Components) ---
        const Icon = ({ path, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const Icons = {
            Menu: <path d="M3 12h18M3 6h18M3 18h18" />,
            X: <path d="M18 6 6 18M6 6l12 12" />,
            Search: <React.Fragment><circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" /></React.Fragment>,
            BookOpen: <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2zM22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />,
            Download: <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3" />,
            ChevronRight: <path d="m9 18 6-6-6-6" />,
            Home: <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />,
            Graduation: <path d="M22 10v6M2 10l10-5 10 5-10 5zM6 12v5c3 3 9 3 12 0v-5" />,
            Flask: <path d="M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2M8.5 2h7M7 16h10" />,
            Calculator: <React.Fragment><rect width="16" height="20" x="4" y="2" rx="2" /><line x1="8" x2="16" y1="6" y2="6" /><line x1="16" x2="16" y1="14" y2="18" /><path d="M16 10h.01M12 10h.01M8 10h.01M12 14h.01M8 14h.01M12 18h.01M8 18h.01" /></React.Fragment>,
            Laptop: <path d="M20 16V7a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v9m16 0H4m16 0 1.28 2.55a1 1 0 0 1-.9 1.45H3.62a1 1 0 0 1-.9-1.45L4 16" />,
            Palette: <path d="M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1-4.825 4.825 10.744 10.744 0 0 1-6.38 1.264c-.9.037-1.393-.84-.98-1.55L14 10M10.733 5.076a2.5 2.5 0 0 0-4.025.266l-1.636 2.05a2.5 2.5 0 0 0 .502 3.659l2.25 1.5M10.733 5.076c1.192.174 2.37.544 3.5 1.104" />,
            Globe: <React.Fragment><circle cx="12" cy="12" r="10" /><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20M2 12h20" /></React.Fragment>,
            Moon: <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" />,
            Loader: <path d="M21 12a9 9 0 1 1-6.219-8.56" />
        };

        const { useState, useEffect } = React;

        // --- UTILS: Get Style based on Subject ---
        const getSubjectStyle = (subjectEn = "") => {
            const sub = subjectEn.toLowerCase();
            if (sub.includes('math') || sub.includes('account') || sub.includes('finance')) 
                return { gradient: "from-blue-500 to-cyan-400", icon: Icons.Calculator, shadow: "shadow-blue-200" };
            if (sub.includes('science') || sub.includes('physics') || sub.includes('chem') || sub.includes('bio')) 
                return { gradient: "from-purple-500 to-indigo-400", icon: Icons.Flask, shadow: "shadow-purple-200" };
            if (sub.includes('ict') || sub.includes('computer')) 
                return { gradient: "from-slate-700 to-slate-500", icon: Icons.Laptop, shadow: "shadow-slate-200" };
            if (sub.includes('english')) 
                return { gradient: "from-rose-500 to-pink-400", icon: null, text: "E", shadow: "shadow-pink-200" };
            if (sub.includes('bangla')) 
                return { gradient: "from-emerald-500 to-teal-400", icon: null, text: "অ", shadow: "shadow-emerald-200" };
            if (sub.includes('religion') || sub.includes('islam') || sub.includes('hindu')) 
                return { gradient: "from-amber-500 to-orange-400", icon: Icons.Moon, shadow: "shadow-amber-200" };
            if (sub.includes('art')) 
                return { gradient: "from-fuchsia-500 to-purple-400", icon: Icons.Palette, shadow: "shadow-fuchsia-200" };
            if (sub.includes('bgs') || sub.includes('global') || sub.includes('history')) 
                return { gradient: "from-sky-500 to-blue-400", icon: Icons.Globe, shadow: "shadow-sky-200" };
            
            return { gradient: "from-emerald-500 to-green-400", icon: Icons.BookOpen, shadow: "shadow-emerald-200" };
        };

        // --- COMPONENT: Book Card ---
        const BookCard = ({ book, onClick }) => {
            const style = getSubjectStyle(book.subjectNameEn);
            
            return (
                <div className="group relative bg-white rounded-2xl shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300 border border-gray-100 overflow-hidden flex flex-col h-full">
                    {/* Cover Art */}
                    <div className={`h-40 w-full bg-gradient-to-br ${style.gradient} relative flex items-center justify-center overflow-hidden`}>
                        {/* Decorative Circles */}
                        <div className="absolute -top-6 -right-6 w-24 h-24 bg-white opacity-20 rounded-full blur-xl"></div>
                        <div className="absolute bottom-[-20px] left-[-20px] w-20 h-20 bg-black opacity-10 rounded-full blur-xl"></div>
                        
                        {/* Icon/Text */}
                        <div className="relative z-10 transform group-hover:scale-110 transition-transform duration-500">
                            {style.icon ? (
                                <Icon path={style.icon} size={48} className="text-white drop-shadow-md" />
                            ) : (
                                <span className="text-6xl font-bold text-white drop-shadow-md">{style.text}</span>
                            )}
                        </div>
                    </div>

                    {/* Content */}
                    <div className="p-5 flex-1 flex flex-col">
                        <h3 className="text-lg font-bold text-gray-800 leading-snug mb-1 line-clamp-2" title={book.subjectNameBn}>
                            {book.subjectNameBn}
                        </h3>
                        <p className="text-xs text-gray-500 font-medium tracking-wide uppercase mb-4 truncate">
                            {book.subjectNameEn}
                        </p>

                        <div className="mt-auto flex gap-3 pt-2">
                            <button 
                                onClick={() => onClick(book.pdfUrl)}
                                className="flex-1 bg-gray-900 hover:bg-black text-white py-2.5 rounded-xl text-sm font-medium transition-colors shadow-lg shadow-gray-200 flex items-center justify-center gap-2 group/btn"
                            >
                                <Icon path={Icons.BookOpen} size={16} /> 
                                <span className="group-hover/btn:tracking-wide transition-all">পড়ুন</span>
                            </button>
                            <a 
                                href={book.pdfUrl} 
                                target="_blank"
                                rel="noopener noreferrer"
                                className="p-2.5 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-xl transition-colors border border-gray-200"
                                title="ডাউনলোড"
                            >
                                <Icon path={Icons.Download} size={18} />
                            </a>
                        </div>
                    </div>
                </div>
            );
        };

        // --- COMPONENT: Sidebar Item ---
        const SidebarItem = ({ active, onClick, titleBn, titleEn }) => (
            <button
                onClick={onClick}
                className={`w-full text-left px-4 py-3 rounded-xl transition-all duration-200 flex items-center justify-between group mb-1 ${
                    active 
                    ? 'bg-white text-emerald-700 shadow-md border-l-4 border-emerald-500' 
                    : 'text-gray-600 hover:bg-white/60 hover:text-emerald-600'
                }`}
            >
                <div>
                    <span className={`block text-sm font-bold ${active ? 'text-gray-900' : 'group-hover:text-gray-900'}`}>
                        {titleBn}
                    </span>
                    <span className="text-[10px] uppercase tracking-wider opacity-60 font-medium">
                        {titleEn}
                    </span>
                </div>
                {active && <Icon path={Icons.ChevronRight} size={16} className="text-emerald-500" />}
            </button>
        );

        // --- MAIN APP ---
        const App = () => {
            const [classes, setClasses] = useState([]);
            const [selectedClass, setSelectedClass] = useState(null);
            const [searchTerm, setSearchTerm] = useState("");
            const [sidebarOpen, setSidebarOpen] = useState(false);
            const [pdfUrl, setPdfUrl] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            useEffect(() => {
                fetch('https://abswerit.github.io/SchoolBooks/textbooks.json')
                    .then(res => res.ok ? res.json() : Promise.reject('Network Error'))
                    .then(data => {
                        if (data?.classes?.length) {
                            setClasses(data.classes);
                            setSelectedClass(data.classes[0]);
                        } else {
                            setError("কোনো ডাটা পাওয়া যায়নি");
                        }
                        setLoading(false);
                    })
                    .catch(err => {
                        setError("ইন্টারনেট সংযোগ চেক করুন");
                        setLoading(false);
                    });
            }, []);

            const filteredBooks = selectedClass?.books.filter(book => 
                (book.subjectNameBn?.includes(searchTerm)) || 
                (book.subjectNameEn?.toLowerCase().includes(searchTerm.toLowerCase()))
            ) || [];

            // Loading View
            if (loading) return (
                <div className="h-screen w-full flex flex-col items-center justify-center bg-gray-50">
                    <div className="relative">
                        <div className="w-16 h-16 border-4 border-emerald-200 border-t-emerald-600 rounded-full animate-spin"></div>
                        <div className="absolute inset-0 flex items-center justify-center">
                            <Icon path={Icons.BookOpen} size={24} className="text-emerald-600" />
                        </div>
                    </div>
                    <h2 className="mt-4 text-xl font-bold text-gray-700 animate-pulse">লাইব্রেরি লোড হচ্ছে...</h2>
                </div>
            );

            // Error View
            if (error) return (
                <div className="h-screen flex flex-col items-center justify-center bg-gray-50 p-6 text-center">
                    <div className="p-4 bg-red-100 text-red-600 rounded-full mb-4"><Icon path={Icons.X} size={48} /></div>
                    <h2 className="text-2xl font-bold text-gray-800">দুঃখিত!</h2>
                    <p className="text-gray-500 mt-2">{error}</p>
                    <button onClick={() => window.location.reload()} className="mt-6 px-8 py-3 bg-gray-900 text-white rounded-xl hover:bg-black transition">রিফ্রেশ করুন</button>
                </div>
            );

            return (
                <div className="flex h-screen overflow-hidden bg-[#F3F4F6]">
                    
                    {/* Backdrop for Mobile Sidebar */}
                    {sidebarOpen && (
                        <div 
                            className="fixed inset-0 bg-black/40 z-30 lg:hidden backdrop-blur-sm transition-opacity"
                            onClick={() => setSidebarOpen(false)}
                        ></div>
                    )}

                    {/* Sidebar */}
                    <aside className={`fixed lg:static inset-y-0 left-0 w-80 bg-gray-50/80 border-r border-gray-200 transform transition-transform duration-300 z-40 lg:translate-x-0 ${sidebarOpen ? 'translate-x-0' : '-translate-x-full'} flex flex-col glass`}>
                        <div className="p-6 flex items-center gap-3 border-b border-gray-200/50 bg-white/50">
                            <div className="w-10 h-10 bg-gradient-to-tr from-emerald-500 to-teal-400 rounded-xl flex items-center justify-center shadow-lg shadow-emerald-200 text-white">
                                <Icon path={Icons.Home} size={20} />
                            </div>
                            <div>
                                <h1 className="text-xl font-bold text-gray-800 leading-none">NCTB</h1>
                                <p className="text-xs font-medium text-emerald-600 tracking-wider">SMART LIBRARY</p>
                            </div>
                        </div>

                        <div className="flex-1 overflow-y-auto p-4 hide-scroll">
                            <div className="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4 px-2 mt-2">শ্রেণি তালিকা</div>
                            {classes.map((cls, idx) => (
                                <SidebarItem 
                                    key={idx}
                                    active={selectedClass?.classTag === cls.classTag}
                                    onClick={() => {
                                        setSelectedClass(cls);
                                        setSidebarOpen(false);
                                        setSearchTerm("");
                                    }}
                                    titleBn={cls.classNameBn}
                                    titleEn={cls.classNameEn}
                                />
                            ))}
                        </div>
                    </aside>

                    {/* Main Content */}
                    <main className="flex-1 flex flex-col h-screen overflow-hidden relative w-full">
                        {/* Navbar */}
                        <header className="px-6 py-4 glass z-20 flex items-center justify-between sticky top-0 border-b border-white/50">
                            <div className="flex items-center gap-4">
                                <button onClick={() => setSidebarOpen(true)} className="lg:hidden p-2 bg-white rounded-lg shadow-sm text-gray-600 hover:text-emerald-600 transition">
                                    <Icon path={Icons.Menu} size={24} />
                                </button>
                                <div>
                                    <h2 className="text-xl lg:text-2xl font-bold text-gray-800 hidden sm:block">
                                        {selectedClass?.classNameBn}
                                    </h2>
                                    <span className="text-xs font-medium text-gray-500 hidden sm:block">
                                        {selectedClass?.classNameEn} • {filteredBooks.length} টি বই
                                    </span>
                                </div>
                            </div>

                            <div className="relative group w-full max-w-xs sm:max-w-md">
                                <div className="absolute inset-y-0 left-3 flex items-center pointer-events-none text-gray-400 group-focus-within:text-emerald-600 transition-colors">
                                    <Icon path={Icons.Search} size={18} />
                                </div>
                                <input 
                                    type="text" 
                                    placeholder="বই খুঁজুন..." 
                                    className="w-full pl-10 pr-4 py-3 bg-white border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all shadow-sm placeholder-gray-400"
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                />
                            </div>
                        </header>

                        {/* Content Grid */}
                        <div className="flex-1 overflow-y-auto p-6 lg:p-8 hide-scroll">
                            <div className="max-w-7xl mx-auto">
                                {/* Mobile Title */}
                                <div className="sm:hidden mb-6">
                                    <h2 className="text-xl font-bold text-gray-800">{selectedClass?.classNameBn}</h2>
                                    <p className="text-xs text-gray-500">{filteredBooks.length} টি বই পাওয়া গেছে</p>
                                </div>

                                {filteredBooks.length > 0 ? (
                                    <div className="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4 lg:gap-6">
                                        {filteredBooks.map((book, idx) => (
                                            <BookCard 
                                                key={idx} 
                                                book={book} 
                                                onClick={setPdfUrl} 
                                            />
                                        ))}
                                    </div>
                                ) : (
                                    <div className="flex flex-col items-center justify-center py-20 text-center opacity-60">
                                        <div className="w-24 h-24 bg-gray-200 rounded-full flex items-center justify-center mb-4">
                                            <Icon path={Icons.Search} size={40} className="text-gray-400" />
                                        </div>
                                        <h3 className="text-xl font-bold text-gray-600">কোনো বই পাওয়া যায়নি</h3>
                                        <p className="text-sm text-gray-500">বানান সঠিক কিনা যাচাই করুন</p>
                                    </div>
                                )}
                                <div className="h-20"></div>
                            </div>
                        </div>
                    </main>

                    {/* PDF Modal */}
                    {pdfUrl && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-gray-900/60 backdrop-blur-sm p-4 animate-[fadeIn_0.2s_ease-out]">
                            <div className="bg-white w-full max-w-6xl h-[90vh] rounded-2xl shadow-2xl flex flex-col overflow-hidden animate-[zoomIn_0.3s_ease-out] relative">
                                {/* Modal Header */}
                                <div className="flex items-center justify-between px-6 py-4 border-b border-gray-100 bg-white z-10">
                                    <div className="flex items-center gap-2">
                                        <div className="p-2 bg-emerald-100 text-emerald-600 rounded-lg">
                                            <Icon path={Icons.BookOpen} size={20} />
                                        </div>
                                        <span className="font-bold text-gray-700">বই প্রিভিউ</span>
                                    </div>
                                    <div className="flex gap-2">
                                        <a 
                                            href={pdfUrl} 
                                            target="_blank" 
                                            className="px-4 py-2 text-sm font-semibold bg-gray-900 text-white rounded-lg hover:bg-black transition shadow-lg shadow-gray-200"
                                        >
                                            ব্রাউজারে খুলুন
                                        </a>
                                        <button 
                                            onClick={() => setPdfUrl(null)}
                                            className="p-2 bg-gray-100 hover:bg-red-50 text-gray-600 hover:text-red-500 rounded-lg transition"
                                        >
                                            <Icon path={Icons.X} size={24} />
                                        </button>
                                    </div>
                                </div>
                                {/* PDF Viewer */}
                                <div className="flex-1 bg-gray-100 relative w-full h-full">
                                    <iframe 
                                        src={pdfUrl} 
                                        className="w-full h-full border-0"
                                        title="PDF Viewer"
                                    ></iframe>
                                    <div className="absolute inset-0 flex flex-col items-center justify-center -z-10 text-gray-400">
                                        <Icon path={Icons.Loader} size={40} className="animate-spin mb-2" />
                                        <p className="text-sm font-medium">পিডিএফ লোড হচ্ছে...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
